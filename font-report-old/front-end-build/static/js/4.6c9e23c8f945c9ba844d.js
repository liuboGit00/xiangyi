webpackJsonp([4],{Ukvg:function(e,t){},bra6:function(e,t){},kY1J:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=r("mvHQ"),i=r.n(o),s=r("woOf"),l=r.n(s),n=r("xbEV"),c=r("gY1r"),d=r("Cin5"),p=r("nkcX"),u=r("7+uW"),f=(a=(new u.default).axios,{pagepation:"",reportlist:function(e,t,r){var o=e;o=e?l()(o,this.pagepation):this.pagepation,a.get("/reports",{params:o}).then(function(e){t(e)})},reportsave:function(e,t,r){var o=e;a.post("/reports",o).then(function(e){t(e)})},reportsdelete:function(e,t,r){var o=e;a.delete("/reports/"+o).then(function(e){t(e)})},reportthemeupdate:function(e,t,r){var o=e;a.put("/reports",o).then(function(e){t(e)})},reportpublish:function(e,t,r){var o=e;a.post("/report-publishing",o).then(function(e){t(e)})},reportmerger:function(e,t,r){var o=e;a.post("/reports/merger",o).then(function(e){t(e)})},reportorganize:function(e,t,r){var o=e;a.get("/users/organize",o).then(function(e){t(e)})},reportorganizechild:function(e,t,r){var o=e;a.get("/users/organize/"+o).then(function(e){t(e)})}}),h={props:["dialogOpt"],mounted:function(){this.getReportorganize()},data:function(){return{form:{reportTitle:"",remark:"",usefulTime1:"",usefulTime2:"",urgentType:"",allowTwice:""},defaultProps:{children:"children",label:"label"},dataleft:[],dataright:[],serverobject:f,rules2:{reportTitle:[{validator:function(e,t,r){""===t||void 0===t?r(new Error("输入内容不能为空")):r()},trigger:"blur"}]}}},computed:{dialogobj:function(){return l()(this.dialogOpt)}},components:{Dialogcomponent:p.a},methods:{submitForm:function(e,t,r){var a=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;a.$emit("handlesure-dialog",t,r,a.form)})},resetForm:function(e){this.$refs[e].resetFields()},getReportorganize:function(){var e=this;e.serverobject.reportorganize("",function(t){(t.data.status="SUCCESS")&&(e.dataleft=t.data.data,e.dataleft=e.transData(e.dataleft,"orgId","orgName","orgSupId","children"))})},getCheckedNodesLeft:function(){var e=!1,t=[],r=this.$refs.trees.getCheckedNodes();this.dataright.forEach(function(a,o){e=!1,r.forEach(function(t,r){a.id==t.id&&(e=!0)}),e||t.push(a)}),this.dataright=t},getCheckedNodesRight:function(){var e=[];this.$refs.tree.getCheckedNodes().forEach(function(t,r){t.hasOwnProperty("children")||e.push(t)}),this.dataright.forEach(function(t,r){e.forEach(function(r,a){t.id==r.id&&e.splice(a,1)})}),this.dataright=this.dataright.concat(e)},dialogHandlesure:function(e,t){for(var r in this.form)""==this.form[r]&&delete this.form[r];switch(e){case"保存":case"合并":this.submitForm("ruleForm2",e,t);break;case"发布":this.form.receiveUserId=this.dataright,this.$emit("handlesure-dialog",e,t,this.form);break;case"修改主题分类":this.submitForm("ruleForm2",e,t);break;case"删除":this.$emit("handlesure-dialog",e,t,this.form)}},dialogHandle:function(e,t){this.$emit("handlecancle-dialog",e,t)},transData:function(e,t,r,a,o){for(var i=[],s={},l=t,n=r,c=a,d=o,p=0,u=0,f=0,h=e.length,m=[];f<h;f++){var g={id:e[f][l],label:e[f][n],orgSupId:e[f][c]};m[f]=g}for(;p<h;p++)s[m[p].id]=m[p];for(;u<h;u++){var v=m[u],b=s[v[c]];b?(!b[d]&&(b[d]=[]),b[d].push(v),b.disabled=!0):i.push(v)}return i},setDataToTree:function(e,t,r){if(e)for(var a=0;a<e.length;a++){var o=e[a];if(o.id==t)return this.$set(e[a],"children",[]),void(e[a].children=e[a].children.concat(r));this.setDataToTree(o.children,t,r)}},handleCheckChange:function(e,t,r){var a=this;if(!e.lastchild&&(!e.children||e.children.length<=0)){var o=e.id;f.reportorganizechild(o,function(t){(t.data.status="SUCCESS")&&(t.data.data=a.transData(t.data.data,"userId","userName","aliasName","children"),t.data.data.forEach(function(e,t){e.lastchild=!0}),a.setDataToTree(a.dataleft,e.id,t.data.data))})}}}},m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{},[r("Dialogcomponent",{attrs:{dialogobj:e.dialogobj},on:{"dialog-cancle":e.dialogHandle,"dialog-sure":e.dialogHandlesure}},["发布"==e.dialogobj.title?r("div",[r("div",{staticClass:"treetransfer"},[r("el-tree",{ref:"tree",attrs:{data:e.dataleft,props:e.defaultProps,"show-checkbox":"","node-key":"id"},on:{"check-change":e.handleCheckChange}}),e._v(" "),r("div",{staticClass:"handle"},[r("span",{staticClass:"el-icon-arrow-left",on:{click:e.getCheckedNodesLeft}}),e._v(" "),r("span",{staticClass:"el-icon-arrow-right",on:{click:e.getCheckedNodesRight}})]),e._v(" "),r("el-tree",{ref:"trees",attrs:{data:e.dataright,props:e.defaultProps,"node-key":"id","show-checkbox":""},on:{"check-change":e.handleCheckChange}})],1),e._v(" "),r("el-form",{ref:"form",staticClass:"formpublic",attrs:{model:e.form,"label-width":""}},[r("el-form-item",{attrs:{label:"是否允许二次转发"}},[r("el-radio-group",{model:{value:e.form.allowTwice,callback:function(t){e.$set(e.form,"allowTwice",t)},expression:"form.allowTwice"}},[r("el-radio",{attrs:{label:"0"}},[e._v("是")]),e._v(" "),r("el-radio",{attrs:{label:"1"}},[e._v("否")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"紧急程度"}},[r("el-radio-group",{model:{value:e.form.urgentType,callback:function(t){e.$set(e.form,"urgentType",t)},expression:"form.urgentType"}},[r("el-radio",{attrs:{label:"1"}},[e._v("加急")]),e._v(" "),r("el-radio",{attrs:{label:"2"}},[e._v("紧急")]),e._v(" "),r("el-radio",{attrs:{label:"3"}},[e._v("正常")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"有效期限"}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:e.form.usefulTime,callback:function(t){e.$set(e.form,"usefulTime",t)},expression:"form.usefulTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1):e._e(),e._v(" "),"合并"==e.dialogobj.title?r("div",[r("el-form",{ref:"ruleForm2",attrs:{model:e.form,rules:e.rules2}},[r("el-form-item",{attrs:{label:"请输入合并后的主题",prop:"reportTitle"}},[r("el-input",{attrs:{type:"age","auto-complete":"off"},model:{value:e.form.reportTitle,callback:function(t){e.$set(e.form,"reportTitle",t)},expression:"form.reportTitle"}})],1)],1)],1):e._e(),e._v(" "),"修改主题分类"==e.dialogobj.title?r("div",[r("el-form",{ref:"ruleForm2",attrs:{model:e.form,rules:e.rules2}},[r("el-form-item",{attrs:{label:"请输入保存后的主题",prop:"reportTitle"}},[r("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.reportTitle,callback:function(t){e.$set(e.form,"reportTitle",t)},expression:"form.reportTitle"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1):e._e(),e._v(" "),"删除"==e.dialogobj.title?r("div",[r("div",{staticStyle:{width:"100%",height:"100%",display:"flex","justify-content":"center","font-size":"20px",color:"#6c6e70"}},[e._v("确定删除？")])]):e._e()])],1)},staticRenderFns:[]};var g=r("VU/8")(h,m,!1,function(e){r("Ukvg")},"data-v-495fe956",null).exports,v={data:function(){return{isLastPage:!1,pagepation:{pageNum:1,pageSize:15},serverobject:f,items:[],reportthemelist:[],themevalue:"",formthemelist:[],reports:[],reportsindex:{},reportIdlists:[],reportshowtype:[],checkboxshow:!1,checkednumber:0,angleshowflag:!0,dialogOpt:{dialogflag:!1,width:"536px"},publicsagainflag:!1,publicsflag:!1,suspendOpt:{name:"报告查看",position:"bottom",domClass:"list-top",offsetbottom:"10%",show:!0,bgshow:!1}}},components:{FormSelectGroup:n.a,Scrollframe:d.a,CommonSuspend:c.a,Dialog:g},methods:{previewreport:function(e){if(self=this,e.isMerger)"dashboard"==JSON.parse(e.oldReportIds)[0].templateCode.split("/")[0]?(localStorage.setItem("oldReportIds",e.oldReportIds),window.open("#/dashboardprevmultiple","_blank")):(localStorage.setItem("oldReportIds",e.oldReportIds),window.open("#/reportprevmultiple","_blank"));else switch(e.templateCode){case"dashboard/template_01":window.open("#/dashboardpreview?reportId="+e.reportId,"_blank");break;case"report/template_01":window.open("#/reportpreview?reportId="+e.reportId,"_blank")}},overreportlist:function(e){this.$set(this.suspendOpt,"editshowflag",e.isMerger)},popclick:function(e){this.reportsindex=e},publics:function(){this.checkboxshow=!0,this.publicsflag=!0,this.checkednumber>0&&this.selectDialog("发布")},changecombination:function(e){var t=this;this.reportIdlists.push(e.reportId),this.reportshowtype.push(e.showType),e.checked?(this.checkednumber++,this.reports.push(e)):(this.checkednumber--,this.reports.forEach(function(r,a){r.reportId==e.reportId&&t.reports.splice(a,1)}))},combinations:function(){var e=this,t={};this.checkboxshow=!0,this.checkednumber>1&&this.reportshowtype.forEach(function(r,a){if(0==a&&null!==r)t[r]=!0;else{if(!t[r])return void alert("报告id不一样不能合并");e.selectDialog("合并")}})},ajaxshow:function(e){var t=this;t.isLastPage=!0,t.pagepation=e||t.pagepation,t.serverobject.pagepation=t.pagepation,f.reportlist(e,function(e){var r=e.data.data;t.items=t.items.concat(r.list),t.isLastPage=r.isLastPage})},submitshow:function(e){this.pagepation={pageNum:1,pageSize:15},this.items=[];var t=l()(e,this.pagepation);this.ajaxshow(t)},selectDialog:function(e,t){t?this.dialogOpt.dialogflag=!1:"编辑"==e?(this.dialogOpt={dialogflag:!1,width:"536px",title:e},this.$router.push({path:"/editedashboard",query:{templateId:this.reportsindex.templateId}})):this.dialogOpt={dialogflag:!0,width:"536px",title:e}},submitDialog:function(e,t,r){var a=this,o=r;if("合并"==e){var s=[];a.reports.forEach(function(e){s.push({templateCode:e.templateCode,reportId:e.reportId})}),r.templateId=a.reports[0].reportId;var n=l()({oldReportIds:i()(s)},r);f.reportmerger(n,function(e){(e.data.status="SUCCESS")&&(a.dialogOpt.dialogflag=!1,a.items=[],a.ajaxshow())})}if("发布"==e){var c=[];a.reports.forEach(function(e){o.receiveUserId.forEach(function(t){c.push({reportId:e.reportId,allowTwice:o.allowTwice,urgentType:o.urgentType,usefulTime:o.usefulTime,remark:o.remark,reportTitle:e.reportTitle,receiveUserId:t.id,receiveUserName:t.label})})}),f.reportpublish(c,function(e){(e.data.status="SUCCESS")&&(a.items=[],this.checkboxshow=!1,a.dialogOpt.dialogflag=!1,a.publicsagainflag=!1,a.ajaxshow())})}if("修改主题分类"==e){var d=l()({reportId:this.reportsindex.reportId},r);f.reportthemeupdate(d,function(e){(e.data.status="SUCCESS")&&(a.dialogOpt.dialogflag=!1,a.items=[],a.ajaxshow())})}if("删除"==e){var p=this.reportsindex.reportId;f.reportsdelete(p,function(e){(e.data.status="SUCCESS")&&(a.dialogOpt.dialogflag=!1,a.items=[],a.ajaxshow())})}}}},b={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page"},[r("FormSelectGroup",{attrs:{module:"reportwatch"},on:{"submit-query":e.submitshow}}),e._v(" "),r("CommonSuspend",{staticClass:"content-area",attrs:{suspendobj:e.suspendOpt},on:{"select-dialog":e.selectDialog}},[r("div",{staticClass:"underlinebtn"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.combinations}},[e._v("合并")]),e._v(" "),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.publics}},[e._v("发布")])],1),e._v(" "),r("Scrollframe",{staticClass:"content-frame",attrs:{isLastPage:e.isLastPage},on:{"ajax-query":e.ajaxshow}},e._l(e.items,function(t,a){return r("div",{key:a,staticClass:"receivelist",on:{mouseover:function(r){e.overreportlist(t)},mousedown:function(r){e.popclick(t)}}},[r("div",{staticClass:"list-top",on:{click:function(r){e.previewreport(t)}}},[e.angleshowflag?r("span",{staticClass:"defaultitle",attrs:{title:t.reportTitle}},[e._v(e._s(t.reportTitle))]):e._e(),e._v(" "),e._l(t.titleList,function(t,a){return e.angleshowflag?e._e():r("span",{key:a,staticClass:"multipletitle"},[e._v("\n                  "+e._s(t.reportTitle)+"\n                ")])}),e._v(" "),t.publishStatus?e._e():r("div",{staticClass:"angle"},[r("div",{staticClass:"obliqueangle"},[e._v("未发布")])])],2),e._v(" "),e.checkboxshow?r("div",{staticClass:"combination"},[r("el-checkbox",{on:{change:function(r){e.changecombination(t)}},model:{value:t.checked,callback:function(r){e.$set(t,"checked",r)},expression:"item.checked"}})],1):e._e()])}))],1),e._v(" "),r("Dialog",{attrs:{dialogOpt:e.dialogOpt},on:{"handlecancle-dialog":e.selectDialog,"handlesure-dialog":e.submitDialog}})],1)},staticRenderFns:[]};var k=r("VU/8")(v,b,!1,function(e){r("bra6")},"data-v-bc843544",null);t.default=k.exports},mvHQ:function(e,t,r){e.exports={default:r("qkKv"),__esModule:!0}},qkKv:function(e,t,r){var a=r("FeBl"),o=a.JSON||(a.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}}});
//# sourceMappingURL=4.6c9e23c8f945c9ba844d.js.map