webpackJsonp([6],{4408:function(e,t,a){"use strict";var s=a("woOf"),i=a.n(s),r=a("nkcX"),l=a("xGE3"),o={props:["dialogOpt"],mounted:function(){this.getReportorganize()},data:function(){var e=function(e,t,a){""===t||void 0===t?a(new Error("输入内容不能为空")):a()};return{form:{reportTitle:"",remark:"",usefulTime1:"",usefulTime2:"",urgentType:"",allowTwice:""},defaultProps:{children:"children",label:"label"},dataleft:[],dataright:[],serverobject:l.a,rules2:{reportTitle:[{validator:e,trigger:"blur"}],remark:[{validator:e,trigger:"blur"}]}}},computed:{dialogobj:function(){return i()(this.dialogOpt)}},components:{Dialogcomponent:r.a},methods:{submitForm:function(e,t,a){var s=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;s.$emit("handlesure-dialog",t,a,s.form)})},resetForm:function(e){this.$refs[e].resetFields()},getReportorganize:function(){var e=this;e.serverobject.reportorganize("",function(t){(t.data.status="SUCCESS")&&(e.dataleft=t.data.data,e.dataleft=e.transData(e.dataleft,"orgId","orgName","orgSupId","children"))})},getCheckedNodesLeft:function(){var e=!1,t=[],a=this.$refs.trees.getCheckedNodes();this.dataright.forEach(function(s,i){e=!1,a.forEach(function(t,a){s.id==t.id&&(e=!0)}),e||t.push(s)}),this.dataright=t},getCheckedNodesRight:function(){var e=[];this.$refs.tree.getCheckedNodes().forEach(function(t,a){t.hasOwnProperty("children")||e.push(t)}),this.dataright.forEach(function(t,a){e.forEach(function(a,s){t.id==a.id&&e.splice(s,1)})}),this.dataright=this.dataright.concat(e)},dialogHandlesure:function(e,t){for(var a in this.form)""==this.form[a]&&delete this.form[a];switch(e){case"保存":this.submitForm("ruleForm2",e,t);break;case"发布":this.form.receiveUserId=this.dataright,this.$emit("handlesure-dialog",e,t,this.form)}},dialogHandle:function(e,t){this.$emit("handlecancle-dialog",e,t)},transData:function(e,t,a,s,i){for(var r=[],l={},o=t,n=a,c=s,d=i,p=0,u=0,f=0,m=e.length,h=[];f<m;f++){var v={id:e[f][o],label:e[f][n],orgSupId:e[f][c]};h[f]=v}for(;p<m;p++)l[h[p].id]=h[p];for(;u<m;u++){var g=h[u],b=l[g[c]];b?(!b[d]&&(b[d]=[]),b[d].push(g),b.disabled=!0):r.push(g)}return r},setDataToTree:function(e,t,a){if(e)for(var s=0;s<e.length;s++){var i=e[s];if(i.id==t)return this.$set(e[s],"children",[]),void(e[s].children=e[s].children.concat(a));this.setDataToTree(i.children,t,a)}},handleCheckChange:function(e,t,a){var s=this;if(!e.lastchild&&(!e.children||e.children.length<=0)){var i=e.id;l.a.reportorganizechild(i,function(t){(t.data.status="SUCCESS")&&(t.data.data=s.transData(t.data.data,"userId","userName","aliasName","children"),t.data.data.forEach(function(e,t){e.lastchild=!0}),s.setDataToTree(s.dataleft,e.id,t.data.data))})}}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{},[a("Dialogcomponent",{attrs:{dialogobj:e.dialogobj},on:{"dialog-cancle":e.dialogHandle,"dialog-sure":e.dialogHandlesure}},["发布"==e.dialogobj.title?a("div",[a("div",{staticClass:"treetransfer"},[a("el-tree",{ref:"tree",attrs:{data:e.dataleft,props:e.defaultProps,"show-checkbox":"","node-key":"id"},on:{"check-change":e.handleCheckChange}}),e._v(" "),a("div",{staticClass:"handle"},[a("span",{staticClass:"el-icon-arrow-left",on:{click:e.getCheckedNodesLeft}}),e._v(" "),a("span",{staticClass:"el-icon-arrow-right",on:{click:e.getCheckedNodesRight}})]),e._v(" "),a("el-tree",{ref:"trees",attrs:{data:e.dataright,props:e.defaultProps,"node-key":"id","show-checkbox":""},on:{"check-change":e.handleCheckChange}})],1),e._v(" "),a("el-form",{ref:"form",staticClass:"formpublic",attrs:{model:e.form,"label-width":""}},[a("el-form-item",{attrs:{label:"是否允许二次转发"}},[a("el-radio-group",{model:{value:e.form.allowTwice,callback:function(t){e.$set(e.form,"allowTwice",t)},expression:"form.allowTwice"}},[a("el-radio",{attrs:{label:"0"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"1"}},[e._v("否")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"紧急程度"}},[a("el-radio-group",{model:{value:e.form.urgentType,callback:function(t){e.$set(e.form,"urgentType",t)},expression:"form.urgentType"}},[a("el-radio",{attrs:{label:"1"}},[e._v("加急")]),e._v(" "),a("el-radio",{attrs:{label:"2"}},[e._v("紧急")]),e._v(" "),a("el-radio",{attrs:{label:"3"}},[e._v("正常")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"有效期限"}},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy年MM月dd日 HH:mm:ss",placeholder:"选择日期时间"},model:{value:e.form.usefulTime,callback:function(t){e.$set(e.form,"usefulTime",t)},expression:"form.usefulTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1):e._e(),e._v(" "),"保存"==e.dialogobj.title?a("div",[a("el-form",{ref:"ruleForm2",attrs:{model:e.form,rules:e.rules2}},[a("el-form-item",{attrs:{label:"请输入保存后的主题",prop:"reportTitle"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.reportTitle,callback:function(t){e.$set(e.form,"reportTitle",t)},expression:"form.reportTitle"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1):e._e()])],1)},staticRenderFns:[]};var c=a("VU/8")(o,n,!1,function(e){a("dtoH")},"data-v-2b649d58",null);t.a=c.exports},"8ff5":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("z/YV"),i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("div",{staticClass:"emptyformgroup"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.suspendflag,expression:"suspendflag"}],staticClass:"topsuspend"},[a("div",{staticClass:"childsuspend"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.choicesuspend}},[e._v("媒体"),a("i",{staticClass:"el-icon-caret-bottom"})]),e._v(" "),a("div",{staticClass:"tooltip"},[a("el-tabs",{attrs:{stretch:"true"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"图片",name:"first"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.action,"file-list":e.fileList,accept:".gif,.jpg,.bmp,.png,.jpeg","on-success":e.successfulupload,limit:1,"auto-upload":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitUpload}},[e._v("上传到服务器")])],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"childsuspend"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.choicesuspend}},[e._v("图表"),a("i",{staticClass:"el-icon-caret-bottom"})]),e._v(" "),a("div",{staticClass:"tooltip"},[a("el-tabs",{attrs:{stretch:"true"},on:{"tab-click":e.handleClick},model:{value:e.activeNametwo,callback:function(t){e.activeNametwo=t},expression:"activeNametwo"}},[a("el-tab-pane",{staticClass:"clearfix",attrs:{label:"分组表",name:"first2"}},e._l(e.itemsform,function(t,s){return a("el-button",{key:s,attrs:{type:"primary",size:"small"},on:{click:function(a){e.successreportform(t)}}},[e._v(e._s(t.reportFormsTitle))])})),e._v(" "),a("el-tab-pane",{staticClass:"clearfix",attrs:{label:"垂直柱状图",name:"second2"}},e._l(e.itemsform,function(t,s){return a("el-button",{key:s,attrs:{type:"primary",size:"small"},on:{click:function(a){e.successreportform(t)}}},[e._v(e._s(t.reportFormsTitle))])})),e._v(" "),a("el-tab-pane",{staticClass:"clearfix",attrs:{label:"水平柱状图",name:"third2"}},e._l(e.itemsform,function(t,s){return a("el-button",{key:s,attrs:{type:"primary",size:"small"},on:{click:function(a){e.successreportform(t)}}},[e._v(e._s(t.reportFormsTitle))])})),e._v(" "),a("el-tab-pane",{staticClass:"clearfix",attrs:{label:"折线图",name:"four2"}},e._l(e.itemsform,function(t,s){return a("el-button",{key:s,attrs:{type:"primary",size:"small"},on:{click:function(a){e.successreportform(t)}}},[e._v(e._s(t.reportFormsTitle))])})),e._v(" "),a("el-tab-pane",{staticClass:"clearfix",attrs:{label:"饼图",name:"five2"}},e._l(e.itemsform,function(t,s){return a("el-button",{key:s,attrs:{type:"primary",size:"small"},on:{click:function(a){e.successreportform(t)}}},[e._v(e._s(t.reportFormsTitle))])}))],1)],1)],1),e._v(" "),a("div",{staticClass:"childsuspend"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.choicesuspend}},[e._v("主题"),a("i",{staticClass:"el-icon-caret-bottom"})]),e._v(" "),a("div",{staticClass:"tooltip"},[a("div",{staticClass:"filter"},[a("div",[a("label",{staticStyle:{color:"black"}},[e._v("主题分类")]),e._v(" "),a("el-select",{attrs:{placeholder:"主题分类"},on:{change:e.themechange},model:{value:e.themevalue,callback:function(t){e.themevalue=t},expression:"themevalue"}},e._l(e.reportthemelist,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1)]),e._v(" "),a("div",{staticClass:"filter-btn clearfix"},e._l(e.formthemelist,function(t,s){return a("el-button",{key:s,attrs:{type:"primary"},on:{click:function(a){e.successtheme(t)}}},[e._v(e._s(t.reportFormsTitle))])})),e._v(" "),a("div",{staticClass:"filter-foot"},[a("el-button",{attrs:{type:"primary"},on:{click:e.savetheme}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"primary"}},[e._v("取消")])],1)])],1)])]),e._v(" "),a("div",{staticClass:"dashboardtemplate"},[a("div",{staticClass:"aside top"},[a("div",{staticClass:"template"},[a("div",{staticClass:"templatelist",attrs:{id:"regionReport_01"}},[a("span",{staticClass:"addcen el-icon-circle-plus",on:{click:function(t){e.addgraphe("regionReport_01")}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.deleteflag,expression:"deleteflag"}],staticClass:"delete iconfont icon-shanchu"})]),e._v(" "),a("div",{staticClass:"templatelist",attrs:{id:"regionReport_02"}},[a("span",{staticClass:"addcen el-icon-circle-plus",on:{click:function(t){e.addgraphe("regionReport_02")}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.deleteflag,expression:"deleteflag"}],staticClass:"delete iconfont icon-shanchu"})])]),e._v(" "),a("div",{staticClass:"template double"},[a("div",{staticClass:"templatelist",attrs:{id:"regionReport_03"}},[a("span",{staticClass:"addcen el-icon-circle-plus",on:{click:function(t){e.addgraphe("regionReport_03")}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.deleteflag,expression:"deleteflag"}],staticClass:"delete iconfont icon-shanchu"})])]),e._v(" "),a("div",{staticClass:"template"},[a("div",{staticClass:"templatelist",attrs:{id:"regionReport_04"}},[a("span",{staticClass:"addcen el-icon-circle-plus",on:{click:function(t){e.addgraphe("regionReport_04")}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.deleteflag,expression:"deleteflag"}],staticClass:"delete iconfont icon-shanchu"})]),e._v(" "),a("div",{staticClass:"templatelist",attrs:{id:"regionReport_05"}},[a("span",{staticClass:"addcen el-icon-circle-plus",on:{click:function(t){e.addgraphe("regionReport_05")}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.deleteflag,expression:"deleteflag"}],staticClass:"delete iconfont icon-shanchu"})])])]),e._v(" "),a("div",{staticClass:"aside bot"},[a("div",{staticClass:"template"},[a("div",{staticClass:"templatelist",attrs:{id:"regionReport_06"}},[a("span",{staticClass:"addcen el-icon-circle-plus",on:{click:function(t){e.addgraphe("regionReport_06")}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.deleteflag,expression:"deleteflag"}],staticClass:"delete iconfont icon-shanchu"})]),e._v(" "),a("div",{staticClass:"templatelist",attrs:{id:"regionReport_07"}},[a("span",{staticClass:"addcen el-icon-circle-plus",on:{click:function(t){e.addgraphe("regionReport_07")}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.deleteflag,expression:"deleteflag"}],staticClass:"delete iconfont icon-shanchu"})]),e._v(" "),a("div",{staticClass:"templatelist",attrs:{id:"regionReport_08"}},[a("span",{staticClass:"addcen el-icon-circle-plus",on:{click:function(t){e.addgraphe("regionReport_08")}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.deleteflag,expression:"deleteflag"}],staticClass:"delete iconfont icon-shanchu"})]),e._v(" "),a("div",{staticClass:"templatelist",attrs:{id:"regionReport_09"}},[a("span",{staticClass:"addcen el-icon-circle-plus",on:{click:function(t){e.addgraphe("regionReport_09")}}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.deleteflag,expression:"deleteflag"}],staticClass:"delete iconfont icon-shanchu"})])])]),e._v(" "),a("div",{staticClass:"footbtn"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.preview}},[e._v("预览")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.savetemplate}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.publics}},[e._v("发布")])],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.suspendflag,expression:"suspendflag"}],staticClass:"addelement"}),e._v(" "),a("Dialog",{attrs:{dialogOpt:e.dialogOpt},on:{"handlecancle-dialog":e.selectDialog,"handlesure-dialog":e.submitDialog}})],1)},staticRenderFns:[]};var r=function(e){a("IxUt")},l=a("VU/8")(s.a,i,!1,r,"data-v-f8b9cd24",null);t.default=l.exports},IxUt:function(e,t){},dtoH:function(e,t){},"z/YV":function(e,t,a){"use strict";(function(e){var s=a("woOf"),i=a.n(s),r=a("4408"),l=a("xGE3");t.a={data:function(){return{reportthemelist:[],themevalue:"",formthemelist:[],report:{reportTitle:"",reportId:""},publicsagainflag:!1,publicsflag:!1,templateId:this.$route.query.templateId,serverobject:l.a,suspendflag:!1,dialogOpt:{dialogflag:!1,width:"536px"},form:{region:""},action:window.localStorage.getItem("baseURL")+"upload/image",imgBaseURL:window.localStorage.getItem("imgBaseURL"),fileList:[],itemsform:[],moduleCode:"",activeName:"first",activeNametwo:"first2",deleteflag:!1}},components:{Dialog:r.a},methods:{successtheme:function(e){this.suspendflag=!1;var t="<span class='formcontent' style='display:flex;align-items: center;justify-content: center;width:100%;height:100%;background: rgba(21, 15, 15, 0.28);'>"+e.reportFormsTitle+"</span>";this.addgraphecontent(t,".formcontent",1)},themechange:function(){var e=this,t={themeId:this.themevalue};e.formthemelist=[],l.a.reportforms(t,function(t){(t.data.status="SUCCESS")&&(e.formthemelist=t.data.data.list)})},queryreporttheme:function(){var e=this;l.a.reportformstheme("",function(t){(t.data.status="SUCCESS")&&(e.reportthemelist=[],t.data.data.list.forEach(function(t,a){e.reportthemelist.push({value:String(t.themeId),label:t.themeName})}))})},addgraphecontent:function(t,a,s,i){e("#"+this.moduleCode).attr({dataType:s,reportFormsCode:i}).append(t).find(".addcen").css("display","none"),e("#"+this.moduleCode).find(a).on("mouseover mouseout",function(t){"mouseover"==t.type?e(this).offsetParent().find(".delete").css({display:"block"}):e(this).offsetParent().find(".delete").css({display:"none"})})},successreportform:function(e){this.suspendflag=!1;var t="<span class='formcontent' style='display:flex;align-items: center;justify-content: center;width:100%;height:100%;background: rgba(21, 15, 15, 0.28);'>"+e.reportFormsTitle+"</span>";this.addgraphecontent(t,".formcontent",1,e.reportFormsCode)},successforms:function(t){var a=this,s={formsType:t};l.a.reportforms(s,function(s){(s.data.status="SUCCESS")&&(e("#reportform_"+t).css({display:"none"}),a.itemsform=s.data.data.list)})},successfulupload:function(e,t,a){if("SUCCESS"==e.status){this.suspendflag=!1,this.fileList=[];var s="<img width='100%' height='100%' src="+this.imgBaseURL+e.data.fileName+">";this.addgraphecontent(s,"img",3)}},submitUpload:function(){this.$refs.upload.submit()},preview:function(){var t=e(".dashboardtemplate").clone().html();localStorage.setItem("share",t),window.open("#/dashboardpreview","_blank")},publics:function(){var t=e(".dashboardtemplate").clone().html();localStorage.setItem("share",t),this.publicsflag=!0,this.selectDialog("保存")},savetemplate:function(){var t=e(".dashboardtemplate").clone().html();localStorage.setItem("share",t),this.selectDialog("保存")},savetheme:function(){this.suspendflag=!1},choicesuspend:function(t){e(".tooltip").css("display","none"),e(t.target).offsetParent().find(".tooltip").css("display","block"),this.queryreporttheme(),this.successforms("1")},handleClick:function(e,t){switch(this.itemsform=[],e.label){case"分组表":this.successforms("1");break;case"垂直柱状图":this.successforms("2");break;case"水平柱状图":this.successforms("3");break;case"折线图":this.successforms("4");break;case"饼图":this.successforms("5")}},addgraphe:function(e){this.suspendflag=!0,this.moduleCode=e},selectDialog:function(e,t){t?(this.dialogOpt.dialogflag=!1,self.publicsagainflag=!1):this.dialogOpt={dialogflag:!0,width:"536px",title:e}},submitDialog:function(t,a,s){var r=this;if(s.templateId=r.templateId,r.publicsagainflag){var o=[];s.receiveUserId.forEach(function(e){o.push({reportId:r.report.reportId,allowTwice:s.allowTwice,urgentType:s.urgentType,usefulTime:s.usefulTime,remark:s.remark,reportTitle:r.report.reportTitle,receiveUserId:e.id,receiveUserName:e.label})}),l.a.reportpublish(o,function(e){(e.data.status="SUCCESS")&&(r.dialogOpt.dialogflag=!1,r.publicsagainflag=!1,r.$router.push({path:"/reportpublic"}))})}else{this.report.reportTitle=s.reportTitle;var n={report:s},c={reportModules:[]};e(".templatelist").each(function(e,t){var a="",s="";3==t.getAttribute("dataType")&&(a=t.lastChild.src.substr(t.lastChild.src.lastIndexOf("/")+1)),2==t.getAttribute("dataType")&&(a=t.lastChild.innerHTML),1==t.getAttribute("dataType")&&(a=t.lastChild.innerHTML,s=t.getAttribute("reportformscode")),c.reportModules.push({moduleCode:t.getAttribute("id"),dataType:t.getAttribute("dataType")?t.getAttribute("dataType"):null,dataContent:a,reportFormsCode:s})});var d=i()(c,n);l.a.reportsave(d,function(e){(e.data.status="SUCCESS")&&(r.dialogOpt.dialogflag=!1,r.publicsflag?(r.selectDialog("发布"),r.publicsagainflag=!0,r.report.reportId=e.data.data.reportId):r.$router.push({path:"/reportwatch"}))})}},handleClose:function(e){this.$confirm("确认关闭？").then(function(t){e()}).catch(function(e){})}}}}).call(t,a("7t+N"))}});
//# sourceMappingURL=6.140fea3577c6bcae67fe.js.map